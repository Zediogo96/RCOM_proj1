#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include "macros.h"


// INTENDER TO BE PACKETS GENERATED BY THE APPLICATION
unsigned int get_controlpacket(unsigned char *filename, int fileSize, int start, unsigned char packet[])
{
    unsigned int filename_size = strlen(filename);
    // FALTA AQUI VERIFICAÇÃO I THINK (VERIF 1)
    if (filename_size > 255)
    {
        printf("Filename size is greater than 1 byte, aborting...\n");
        return 0;
    }

    size_t index = 0;

    if (start == TRUE)
        packet[index++] = C_ZERO;
    else if (start == FALSE)
        packet[index++] = C_ONE;
    
    // FALTA AQUI STUFF, AINDA NÃO SEI O QUE É SUPOSTO METER

    // SEI QUE O FILENAME VAI TER DE IR NA FRAME
    // RELACIONADO COM ACIMA (VERIF 1)
    for (int i = 0; i < filename_size; i++)
        packet[index++] = filename[i];

    // FALTA AQUI STUFF, AINDA NÃO SEI O QUE É SUPOSTO METER

    for (int i = 0; i < 4; i++)
        packet[index++] = (fileSize >> (8 * i)) & 0xFF;
    
    return index; // alias packetSize

}